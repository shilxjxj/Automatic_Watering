C51 COMPILER V9.00   LCD12864                                                              04/26/2019 16:22:48 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN ..\bin\LCD12864.obj
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE ..\src\LCD12864.c BROWSE INCDIR(..\inc) DEBUG OBJECTEXTEND PRINT(.\LCD1286
                    -4.lst) OBJECT(..\bin\LCD12864.obj)

line level    source

   1          #include <reg52.h>              //头文件
   2          #include <intrins.h>
   3          #include "LCD12864.h"
   4          
   5          /*TS12864A-3 端口定义*/
   6          sbit LCD_RS  =  P0^4;            //寄存器选择输入 
   7          sbit LCD_RW  =  P0^3;            //液晶读/写控制
   8          sbit LCD_EN  =  P0^2;            //液晶使能控制
   9          sbit LCD_PSB =  P0^1;            //串/并方式控制
  10          sbit rst = P0^0;
  11          
  12          
  13          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};
  14          void delay0(uchar x);  //x*0.14MS
  15          void lcd_pos(uchar X,uchar Y);  //确定显示位置
  16          /*******************************************************************/
  17          /*                                                                 */
  18          /*  延时函数                                                       */
  19          /*                                                                 */
  20          /*******************************************************************/
  21          void delay(int ms)
  22          {
  23   1          while(ms--)
  24   1              {
  25   2            uchar i;
  26   2                for(i=0;i<250;i++)  
  27   2                 {
  28   3                  _nop_();                       
  29   3                      _nop_();
  30   3                      _nop_();
  31   3                      _nop_();
  32   3                 }
  33   2              }
  34   1      }               
  35          /*******************************************************************/
  36          /*                                                                 */
  37          /*检查LCD忙状态                                                    */
  38          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
  39          /*                                                                 */
  40          /*******************************************************************/
  41          bit lcd_busy()
  42           {                          
  43   1          bit result;
  44   1          LCD_RS = 0;
  45   1          LCD_RW = 1;
  46   1          LCD_EN = 1;
  47   1          delayNOP();
  48   1          result = (bit)(P2&0x80);
  49   1          LCD_EN = 0;
  50   1          return(result); 
  51   1       }
  52          /*******************************************************************/
  53          /*                                                                 */
  54          /*写指令数据到LCD                                                  */
C51 COMPILER V9.00   LCD12864                                                              04/26/2019 16:22:48 PAGE 2   

  55          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
  56          /*                                                                 */
  57          /*******************************************************************/
  58          void lcd_wcmd(uchar cmd)
  59          {                          
  60   1         while(lcd_busy());
  61   1          LCD_RS = 0;
  62   1          LCD_RW = 0;
  63   1          LCD_EN = 0;
  64   1          _nop_();
  65   1          _nop_(); 
  66   1          P2 = cmd;
  67   1          delayNOP();
  68   1          LCD_EN = 1;
  69   1          delayNOP();
  70   1          LCD_EN = 0;  
  71   1      }
  72          /*******************************************************************/
  73          /*                                                                 */
  74          /*写显示数据到LCD                                                  */
  75          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
  76          /*                                                                 */
  77          /*******************************************************************/
  78          void lcd_wdat(uchar dat)
  79          {                          
  80   1         while(lcd_busy());
  81   1          LCD_RS = 1;
  82   1          LCD_RW = 0;
  83   1          LCD_EN = 0;
  84   1          P2 = dat;
  85   1          delayNOP();
  86   1          LCD_EN = 1;
  87   1          delayNOP();
  88   1          LCD_EN = 0; 
  89   1      }
  90          /*******************************************************************/
  91          /*                                                                 */
  92          /*  LCD初始化设定                                                  */
  93          /*                                                                 */
  94          /*******************************************************************/
  95          void lcd_init()
  96          { 
  97   1      
  98   1          LCD_PSB = 1;         //并口方式
  99   1          rst=1;
 100   1          lcd_wcmd(0x30);      //基本指令操作
 101   1          delay(5);
 102   1          lcd_wcmd(0x0C);      //显示开，关光标
 103   1          delay(5);
 104   1          lcd_wcmd(0x01);      //清除LCD的显示内容
 105   1          delay(5);
 106   1      }
 107          
 108          /*********************************************************/
 109          /*                                                       */
 110          /* 设定显示位置                                          */
 111          /*                                                       */
 112          /*********************************************************/
 113          void lcd_pos(uchar X,uchar Y)
 114          {                          
 115   1         uchar  pos;
 116   1         if (X==0)
C51 COMPILER V9.00   LCD12864                                                              04/26/2019 16:22:48 PAGE 3   

 117   1           {X=0x80;}
 118   1         else if (X==1)
 119   1           {X=0x90;}
 120   1         else if (X==2)
 121   1           {X=0x88;}
 122   1         else if (X==3)
 123   1           {X=0x98;}
 124   1         pos = X+Y ;  
 125   1         lcd_wcmd(pos);     //设置显示地址
 126   1      }
 127          
 128          /*********************************************************/
 129          /*                                                       */
 130          /* 字符串显示函数                                          */
 131          /*                                                       */
 132          /*********************************************************/
 133          void lcd_show(uchar *str) 
 134          {
 135   1              uchar i=0;
 136   1              while(str[i]!='\0')
 137   1              {
 138   2                      lcd_wdat(str[i]);
 139   2                      i++;
 140   2              }
 141   1      
 142   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    207    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
